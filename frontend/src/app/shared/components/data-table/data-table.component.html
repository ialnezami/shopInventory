<div class="data-table-container">
  <!-- Loading indicator -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Filters Section -->
  <div *ngIf="showFilters" class="filters-section">
    <div class="filters-header">
      <h4>Filters</h4>
      <button 
        *ngIf="filters.length > 0" 
        class="btn btn-outline-secondary btn-sm"
        (click)="clearAllFilters()">
        Clear All
      </button>
    </div>
    
    <div class="filters-grid">
      <div *ngFor="let column of columns" class="filter-item" [class.filterable]="column.filterable">
        <label *ngIf="column.filterable" [for]="'filter-' + column.key">
          {{ column.label }}
        </label>
        
        <div *ngIf="column.filterable" class="filter-controls">
          <select 
            [id]="'operator-' + column.key"
            class="form-select form-select-sm"
            (change)="addFilter(column.key, $event.target.value, $event.target.value as any)">
            <option value="">Select operator</option>
            <option value="contains">Contains</option>
            <option value="equals">Equals</option>
            <option value="startsWith">Starts with</option>
            <option value="endsWith">Ends with</option>
            <option *ngIf="column.type === 'number'" value="greaterThan">Greater than</option>
            <option *ngIf="column.type === 'number'" value="lessThan">Less than</option>
          </select>
          
          <input 
            [id]="'filter-' + column.key"
            type="text" 
            class="form-control form-control-sm"
            [placeholder]="'Filter ' + column.label"
            (input)="addFilter(column.key, $event.target.value, 'contains')">
        </div>
        
        <!-- Active filter indicator -->
        <div *ngIf="filters.some(f => f.column === column.key)" class="active-filter">
          <span class="badge bg-primary">
            {{ filters.find(f => f.column === column.key)?.value }}
          </span>
          <button 
            class="btn-close btn-close-sm"
            (click)="removeFilter(column.key)">
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bulk Actions -->
  <div *ngIf="showBulkActions && selectedItems.size > 0" class="bulk-actions">
    <span class="selected-count">
      {{ selectedItems.size }} item(s) selected
    </span>
    <div class="bulk-buttons">
      <button 
        class="btn btn-danger btn-sm"
        (click)="onBulkAction('delete')">
        Delete Selected
      </button>
      <button 
        class="btn btn-warning btn-sm"
        (click)="onBulkAction('export')">
        Export Selected
      </button>
      <button 
        class="btn btn-info btn-sm"
        (click)="onBulkAction('update')">
        Update Selected
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <!-- Select All Checkbox -->
          <th *ngIf="showBulkActions" class="select-all-column">
            <input 
              type="checkbox" 
              class="form-check-input"
              [checked]="selectAll"
              (change)="toggleSelectAll()">
          </th>
          
          <!-- Column Headers -->
          <th 
            *ngFor="let column of columns" 
            [style.width]="column.width"
            [class.sortable]="column.sortable"
            (click)="column.sortable ? onSort(column.key) : null">
            <div class="column-header">
              <span>{{ column.label }}</span>
              <span *ngIf="column.sortable" class="sort-icon">
                {{ getSortIcon(column.key) }}
              </span>
            </div>
          </th>
        </tr>
      </thead>
      
      <tbody>
        <tr *ngFor="let item of paginatedData; trackBy: trackByFn">
          <!-- Select Row Checkbox -->
          <td *ngIf="showBulkActions" class="select-row-column">
            <input 
              type="checkbox" 
              class="form-check-input"
              [checked]="isItemSelected(item)"
              (change)="toggleItemSelection(item)">
          </td>
          
          <!-- Data Cells -->
          <td *ngFor="let column of columns" [class]="'cell-' + column.type">
            <ng-container [ngSwitch]="column.type">
              <!-- Text/Default -->
              <span *ngSwitchDefault>
                {{ getNestedValue(item, column.key) }}
              </span>
              
              <!-- Number -->
              <span *ngSwitchCase="'number'" class="number-cell">
                {{ getNestedValue(item, column.key) | number }}
              </span>
              
              <!-- Date -->
              <span *ngSwitchCase="'date'" class="date-cell">
                {{ getNestedValue(item, column.key) | date:'short' }}
              </span>
              
              <!-- Boolean -->
              <span *ngSwitchCase="'boolean'" class="boolean-cell">
                <span class="badge" [class]="getNestedValue(item, column.key) ? 'bg-success' : 'bg-secondary'">
                  {{ getNestedValue(item, column.key) ? 'Yes' : 'No' }}
                </span>
              </span>
              
              <!-- Action -->
              <div *ngSwitchCase="'action'" class="action-buttons">
                <button class="btn btn-sm btn-outline-primary me-1">
                  <i class="bi bi-eye"></i>
                </button>
                <button class="btn btn-sm btn-outline-warning me-1">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </ng-container>
          </td>
        </tr>
        
        <!-- Empty state -->
        <tr *ngIf="paginatedData.length === 0">
          <td [attr.colspan]="columns.length + (showBulkActions ? 1 : 0)" class="text-center text-muted">
            <div class="empty-state">
              <i class="bi bi-inbox fs-1"></i>
              <p>No data available</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination-section">
    <div class="pagination-info">
      <span>
        Showing {{ (currentPage - 1) * currentPageSize + 1 }} to 
        {{ Math.min(currentPage * currentPageSize, filteredData.length) }} of 
        {{ filteredData.length }} entries
      </span>
    </div>
    
    <div class="pagination-controls">
      <!-- Page Size Selector -->
      <div class="page-size-selector">
        <label for="page-size">Show:</label>
        <select 
          id="page-size"
          class="form-select form-select-sm"
          [value]="currentPageSize"
          (change)="onPageSizeChange(+$event.target.value)">
          <option *ngFor="let size of pageSizeOptions" [value]="size">
            {{ size }}
          </option>
        </select>
        <span>entries</span>
      </div>
      
      <!-- Pagination Navigation -->
      <nav aria-label="Table pagination">
        <ul class="pagination pagination-sm mb-0">
          <!-- First Page -->
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button 
              class="page-link" 
              (click)="onPageChange(1)"
              [disabled]="currentPage === 1">
              <i class="bi bi-chevron-double-left"></i>
            </button>
          </li>
          
          <!-- Previous Page -->
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button 
              class="page-link" 
              (click)="onPageChange(currentPage - 1)"
              [disabled]="currentPage === 1">
              <i class="bi bi-chevron-left"></i>
            </button>
          </li>
          
          <!-- Page Numbers -->
          <li 
            *ngFor="let page of pageNumbers" 
            class="page-item"
            [class.active]="page === currentPage">
            <button 
              class="page-link" 
              (click)="onPageChange(page)">
              {{ page }}
            </button>
          </li>
          
          <!-- Next Page -->
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button 
              class="page-link" 
              (click)="onPageChange(currentPage + 1)"
              [disabled]="currentPage === totalPages">
              <i class="bi bi-chevron-right"></i>
            </button>
          </li>
          
          <!-- Last Page -->
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button 
              class="page-link" 
              (click)="onPageChange(totalPages)"
              [disabled]="currentPage === totalPages">
              <i class="bi bi-chevron-double-right"></i>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
